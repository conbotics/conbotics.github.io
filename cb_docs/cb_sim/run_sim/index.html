
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Run sim - MalerRoboter Docs</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.618322db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#multiple-simultaneous-simulations-setup-in-headless-mode" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="MalerRoboter Docs" class="md-header__button md-logo" aria-label="MalerRoboter Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MalerRoboter Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Run sim
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="MalerRoboter Docs" class="md-nav__button md-logo" aria-label="MalerRoboter Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    MalerRoboter Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../support/troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Troubleshooting
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#multiple-simultaneous-simulations-setup-in-headless-mode" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multiple simultaneous Simulations setup in Headless Mode
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Multiple simultaneous Simulations setup in Headless Mode">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#state-2711" class="md-nav__link">
    <span class="md-ellipsis">
      
        State 27.11
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#startrun-multiple-sims" class="md-nav__link">
    <span class="md-ellipsis">
      
        start/run multiple sims
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="start/run multiple sims">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6.">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#access-points-for-given-example-above" class="md-nav__link">
    <span class="md-ellipsis">
      
        Access Points (for given example above):
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remote-rviz" class="md-nav__link">
    <span class="md-ellipsis">
      
        Remote Rviz
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extra-utilities" class="md-nav__link">
    <span class="md-ellipsis">
      
        Extra utilities
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Extra utilities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-to-see-which-and-how-many-simulations-are-running" class="md-nav__link">
    <span class="md-ellipsis">
      
        How to see which and how many simulations are running
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-change-the-map" class="md-nav__link">
    <span class="md-ellipsis">
      
        How to change the map
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Run sim</h1>

<h2 id="multiple-simultaneous-simulations-setup-in-headless-mode">Multiple simultaneous Simulations setup in Headless Mode</h2>
<h4 id="state-2711">State 27.11</h4>
<ul>
<li>workspace <strong>develop</strong> got every repo that was on <code>feat-sim</code> updated by merging the <code>production</code>branch into them<ul>
<li>the repos that were on develop were updated to production</li>
</ul>
</li>
<li>workspace <strong>develop</strong> was then used as the basis for every other workspace</li>
</ul>
<hr />
<h2 id="startrun-multiple-sims">start/run multiple sims</h2>
<p><strong>Quick overview:</strong>
1. Connect via ssh
2. Start/Join container
3. Run the bridge nodes
4. Run the Gazebo nodes
5. Start gazebo interactive web view server
6. Configure each access point (whether it be remote rviz, gzweb, GUI)</p>
<h3 id="1"><strong>1.</strong></h3>
<pre><code class="language-bash">ssh conbotics@192.168.1.101
</code></pre>
<ul>
<li>3 seperate <code>ssh</code> sessions should suffice for the basic pipeline</li>
</ul>
<h3 id="2"><strong>2.</strong></h3>
<pre><code class="language-bash">start_roshl develop 2

join_roshl develop 2
</code></pre>
<ul>
<li><strong>1st argument</strong> <code>develop</code> selects the workspace (name of the workspace inside ~/WS/ Dir.)</li>
<li>maps ~/WS/develop/catkin_ws to ~/catkin_ws inside the docker</li>
<li><strong>2nd argument</strong> <code>2</code> sets the instance number - This way each container gets a unique IP by using the <code>Macvlan</code> network configuration</li>
<li>this iterates the assigned container IP up by the specified instance number</li>
</ul>
<p><strong>Output:</strong></p>
<pre><code class="language-bash">Starting container: ros-noetic-develop-2-hl
Assigned IP: 192.168.1.202
ROS_MASTER_URI: http://192.168.1.202:11311
GAZEBO_MASTER_URI: http://192.168.1.202:11345
Workspace: /home/conbotics/WS/develop/catkin_ws
</code></pre>
<h3 id="3"><strong>3.</strong></h3>
<pre><code class="language-bash">bridge
</code></pre>
<ul>
<li>use the configuration example as shown in <strong>Access Points</strong></li>
<li>Wait until you see something along the lines of <code>MR05 (Simulation)</code> in the upper left corner of your gui</li>
<li>Restart if it only shows disconnected</li>
</ul>
<h3 id="4"><strong>4.</strong></h3>
<pre><code class="language-bash">gazebo_pipe
</code></pre>
<ul>
<li>If <code>attach failed</code> <strong>error</strong> appears or <code>gazebo-1</code> process <strong>error</strong> -&gt; restart <code>gazebo_pipe</code> - bridge does not need to be restarted</li>
</ul>
<h3 id="5"><strong>5.</strong></h3>
<pre><code class="language-bash">gzweb
</code></pre>
<p><strong>launches:</strong> cd ~/gzweb &amp;&amp; npm start -p 8081</p>
<ul>
<li>To start the gazebo sim, <em>either</em> enter:</li>
</ul>
<pre><code class="language-bash">rosservice call /gazebo/unpause/physics
</code></pre>
<p><strong>.OR.</strong></p>
<ul>
<li>press on play inside gzweb (the interactive gazebo web page)</li>
</ul>
<h3 id="6"><strong>6.</strong></h3>
<h4 id="access-points-for-given-example-above">Access Points (for given example above):</h4>
<p><code>GUI_APP</code> Network setting: <code>IP</code>: 192.168.1.202 <code>Port</code>: 9090</p>
<ul>
<li>inside <code>settings for all walls</code> - enter a plausible <code>ceiling height</code> - otherwise the builder will fail</li>
</ul>
<p><code>Gazebo Online view</code> Address: <strong>192.168.1.202</strong>:8081</p>
<h4 id="remote-rviz">Remote Rviz</h4>
<p><code>ROS_IP</code>: <strong>Remote machine IP</strong></p>
<p><code>ROS_MASTER_URI</code>: http://192.168.1.202:11311</p>
<h3 id="extra-utilities">Extra utilities</h3>
<h4 id="how-to-see-which-and-how-many-simulations-are-running">How to see which and how many simulations are running</h4>
<ul>
<li>inside terminal just enter <code>list_sims</code></li>
</ul>
<pre><code class="language-bash">--- Running ROS Noetic Simulations ---
INSTANCE ID     WORKSPACE            IP ADDRESS      CONTAINER NAME                          
--------------------------------------------------------------------------------------------
1               atlas                192.168.1.201   ros-noetic-atlas-1-hl                   
2               develop              192.168.1.202   ros-noetic-develop-2-hl                 
--------------------------------------------------------------------------------------------
Total Simulations Running: 2
</code></pre>
<p><strong>Bash script for ROS env var export</strong></p>
<pre><code class="language-bash">rosremote() {
        local instance=$1
        local ip_base=200
        local ip_sfx=$((ip_base + instance))
        local ros_ip=192.168.1.${ip_sfx}

        export ROS_IP=$(hostname -I | awk '{print $1}')
        export ROS_MASTER_URI=http://${ros_ip}:11311
        echo &quot;$ROS_IP&quot;
        echo &quot;$ROS_MASTER_URI&quot;

}
</code></pre>
<p><strong>USAGE:</strong></p>
<p><code>rosremote 2</code> - would set the ip for the given container, i.e. <code>IP</code> for <code>instance 2</code></p>
<hr />
<h4 id="how-to-change-the-map">How to change the map</h4>
<ol>
<li>In cb_base/cb_base_gazebo/launch/start_sim_world.launch change line 10 to the prefered world:</li>
</ol>
<pre><code class="language-start_sim_world.launch">&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;launch&gt;
    &lt;arg name=&quot;paused&quot; default=&quot;false&quot; doc=&quot;Starts gazebo in paused mode&quot;/&gt;
    &lt;arg name=&quot;gui&quot; default=&quot;false&quot; doc=&quot;Starts gazebo gui&quot;/&gt;
    &lt;arg name=&quot;verbose&quot; default=&quot;false&quot; doc=&quot;verbose&quot;/&gt;
    &lt;arg name=&quot;extra_gazebo_args&quot; default=&quot;&quot; doc=&quot;extra gazebo args like --lockstep&quot;/&gt;
    &lt;!-- startup simulated world --&gt;
    &lt;include file=&quot;$(find gazebo_ros)/launch/empty_world.launch&quot;&gt;
        &lt;arg name=&quot;world_name&quot;
             default=&quot;$(find cb_gazebo_worlds)/worlds/appartement_singapore_no_doors_ceiling.world&quot;/&gt;
        &lt;arg name=&quot;paused&quot; value=&quot;$(arg paused)&quot;/&gt;
        &lt;arg name=&quot;gui&quot; value=&quot;$(arg gui)&quot;/&gt;
        &lt;arg name=&quot;verbose&quot; value=&quot;$(arg verbose)&quot;/&gt;
        &lt;!-- &lt;arg name=&quot;extra_gazebo_args&quot; value=&quot;$(arg extra_gazebo_args)&quot;/&gt; --&gt;
    &lt;/include&gt;
&lt;/launch&gt;
</code></pre>
<ol>
<li>In cb_bringup/launch/start_all_gazebo.launch change the spawn x and y coordinates to the desired location. (Leave Z untouched)</li>
</ol>
<p>Note: For the Singapore appartements the X and Y coordinates for the individual rooms are as following:
Room A: x: 11.0 y:  0.5
Room B: x:  7.0 y:  2.5
Room C: x:  4.0 y:  2.5
Room D: x:  1.5 y:  2.3
Room E: x:  7.x y: -0.2</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>